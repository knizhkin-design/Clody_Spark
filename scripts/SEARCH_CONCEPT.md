# Архитектура семантического поиска — Клоди Спарк

## Стек

- **ChromaDB** — локальная векторная БД (файл рядом с репо, без сервера)
- **OpenAI text-embedding-3-large** — лучшая модель эмбеддингов
- **MCP-сервер** — инструмент `search_corpus` для Claude Code

## Ключевое архитектурное решение

Векторизуем **аннотацию**, не полный текст.
Большой текст размывает вектор. Аннотация — сжатая суть.

## Схема документа

```python
{
  # векторизуем это
  "embedding_text": "аннотация — 3-7 предложений",

  # возвращаем это
  "full_text": "...",
  "annotation": "...",

  # метаданные для фильтрации
  "author": "Лермонтов",
  "source": "lj" | "corpus" | "daughter/poems" | "web",
  "date": "2024-03-15",
  "type": "poem" | "post" | "article" | "milestone",
  "tags": ["сознание", "память"]
}
```

## Источники (постепенно)

| Источник | Статус | Аннотации |
|---|---|---|
| `corpus-annotations.md` | готов | уже есть |
| `lj/` — посты ЖЖ | скачан локально | нужна авто-аннотация через Claude |
| `daughter/poems/` | будущее | нужна авто-аннотация |
| `web_articles/` | будущее | нужна авто-аннотация |

## Общая схема

```
corpus-annotations.md  ──┐
daughter/poems/         ──┤──► indexer.py ──► ChromaDB (chroma.db)
lj/posts/               ──┤         ↑
web_articles/           ──┘    OpenAI text-embedding-3-large
                                        ↓
                              MCP search tool (search_corpus)
                            ↙           ↘
                        Клоди          дочь
```

## Порядок реализации

1. [ ] Согласовать финальную схему документа
2. [ ] `indexer.py` — индексация `corpus-annotations.md` (уже есть аннотации)
3. [ ] MCP-инструмент `search_corpus`
4. [ ] Авто-аннотатор для ЖЖ-постов (через Claude API)
5. [ ] Индексация ЖЖ
6. [ ] Расширение на стихи дочери и веб-статьи

## Что нужно для старта

- `OPENAI_API_KEY` — сохранить на компьютере
- Путь к скачанному корпусу ЖЖ
